#!/bin/bash
set -e

# Reload and enable service
systemctl daemon-reload
systemctl enable mpn-core.service
systemctl start mpn-core.service

# Update desktop and icon caches
if command -v update-desktop-database &>/dev/null; then
    update-desktop-database
fi
if command -v gtk-update-icon-cache &>/dev/null; then
    gtk-update-icon-cache /usr/share/icons/hicolor || true
fi

# Copy desktop shortcut to user's Desktop
USER_DESKTOP="/home/$SUDO_USER/Desktop"
if [ -d "$USER_DESKTOP" ]; then
    cp /usr/share/applications/mpn-core.desktop "$USER_DESKTOP/"
    chmod +x "$USER_DESKTOP/mpn-core.desktop"
fi

exit 0
